<!DOCTYPE html>
<html>
<head>
    <title>Canvas Test</title>
    <style>
        body { text-align: center; }
        .canvas-container {
            position: relative;
            width: 700px;
            height: 700px;
            border: 1px solid black;
            margin: 50px auto;
            overflow: hidden;
            cursor: grab;
        }
        #myCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #f0f0f0; /* 배경색으로 캔버스 영역 확인 */
        }
        .zoom-controls { margin-bottom: 10px; }
        .zoom-controls button { padding: 5px 10px; }
    </style>
</head>
<body>
    <h1>Canvas Drag & Zoom Test</h1>

    <div class="zoom-controls">
        <button onclick="zoomOut()">-</button>
        <button onclick="zoomIn()">+</button>
    </div>

    <div class="canvas-container">
        <canvas id="myCanvas"></canvas>
    </div>

    <script>
        let myCanvas = null;
        let myCtx = null;
        let canvasContainer = null;

        // --- 테스트용 드로잉 데이터 (가상의 맵) ---
        let testRect = { x: 50, y: 50, width: 100, height: 100, color: 'blue' };

        // 줌/패닝 변수
        let currentZoomLevel = 1.0;
        const zoomStep = 0.2;
        const minZoomLevel = 0.5;
        const maxZoomLevel = 3.0;

        let isDragging = false;
        let lastMouseX = 0;
        let lastMouseY = 0;
        let offsetX = 0;
        let offsetY = 0;

        function drawTestContent() {
            if (!myCtx) return;

            myCtx.clearRect(0, 0, myCanvas.width, myCanvas.height); // 전체 캔버스 지우기

            myCtx.save(); // 현재 Canvas 상태 저장

            myCtx.scale(currentZoomLevel, currentZoomLevel); // 줌 적용
            myCtx.translate(offsetX / currentZoomLevel, offsetY / currentZoomLevel); // 패닝 적용

            // 사각형 그리기 (확대/축소 및 이동 대상)
            myCtx.fillStyle = testRect.color;
            myCtx.fillRect(testRect.x, testRect.y, testRect.width, testRect.height);

            // 텍스트 추가 (확대/축소 및 이동 대상)
            myCtx.font = "20px Arial";
            myCtx.fillStyle = "red";
            myCtx.fillText("TEST MAP", 200, 200);

            myCtx.restore(); // 저장된 Canvas 상태 복원
        }

        // 줌 함수 (동일)
        function setZoom(level) {
            currentZoomLevel = Math.max(minZoomLevel, Math.min(maxZoomLevel, level));
            myCanvas.width = 700; // 캔버스 내부 해상도를 임의로 고정 (컨테이너와 동일하게)
            myCanvas.height = 700;
            drawTestContent();
            console.log("Zoom level:", currentZoomLevel);
        }
        function zoomIn() { setZoom(currentZoomLevel + zoomStep); }
        function zoomOut() { setZoom(currentZoomLevel - zoomStep); }

        // 패닝 함수 (동일)
        function startDragging(e) {
            if (e.button === 0) {
                isDragging = true;
                lastMouseX = e.clientX;
                lastMouseY = e.clientY;
                canvasContainer.style.cursor = 'grabbing';
            }
        }
        function dragMap(e) {
            if (!isDragging) return;
            const dx = e.clientX - lastMouseX;
            const dy = e.clientY - lastMouseY;
            offsetX += dx;
            offsetY += dy;
            lastMouseX = e.clientX;
            lastMouseY = e.clientY;
            drawTestContent();
        }
        function stopDragging() {
            isDragging = false;
            canvasContainer.style.cursor = 'grab';
        }

        document.addEventListener('DOMContentLoaded', function() {
            myCanvas = document.getElementById('myCanvas');
            myCtx = myCanvas.getContext('2d');
            canvasContainer = document.querySelector('.canvas-container');

            if (!myCanvas || !myCtx || !canvasContainer) {
                console.error("Canvas elements not found!");
                return;
            }

            // 캔버스 내부 해상도 설정 (매우 중요)
            myCanvas.width = 700; // 테스트를 위해 700x700으로 고정
            myCanvas.height = 700;

            // 초기 그리기
            drawTestContent();

            // 이벤트 리스너
            canvasContainer.addEventListener('mousedown', startDragging);
            canvasContainer.addEventListener('mousemove', dragMap);
            canvasContainer.addEventListener('mouseup', stopDragging);
            canvasContainer.addEventListener('mouseleave', stopDragging);
        });
    </script>
</body>
</html>