<launch>
    <arg name="map_file" default="map22.yaml" />
    <arg name="open_rviz" default="true" />
    
    <arg name="initial_pose_x" default="0.0" />
    <arg name="initial_pose_y" default="0.0" />
    <arg name="initial_pose_a" default="0.0" />

    <arg name="scan_topic" default="scan" />

    <arg name="odom_model_type" default="diff"/>
    <arg name="odom_alpha1" default="0.2"/>
    <arg name="odom_alpha2" default="0.2"/>
    <arg name="odom_alpha3" default="0.2"/>
    <arg name="odom_alpha4" default="0.2"/>
    <arg name="odom_frame_id" default="odom"/>
    <arg name="base_frame_id" default="base_footprint"/>  
    <!-- odom -> base_link가 아니라 odom -> base_footprint -> base_link로 수정했으므로 base_frame_id를 base_link가 아닌 base_footprint로 수정-->

    <!-- odometry 토픽을 odom으로 바꿈 -->
    <arg name="odom_topic" default="odom" />

    <!-- map server -->
    <node pkg="map_server" name="map_server" type="map_server"
          args="$(find gazebo_sim_pkg)/maps/$(arg map_file)" />

    <!-- AMCL 포함 -->
    <include file="$(find gazebo_sim_pkg)/launch/amcl.launch">
        <arg name="scan_topic" value="$(arg scan_topic)" />
        <arg name="initial_pose_x" value="$(arg initial_pose_x)" />
        <arg name="initial_pose_y" value="$(arg initial_pose_y)" />
        <arg name="initial_pose_a" value="$(arg initial_pose_a)" />
        <arg name="odom_model_type" value="$(arg odom_model_type)"/>
        <arg name="odom_alpha1" value="$(arg odom_alpha1)"/>
        <arg name="odom_alpha2" value="$(arg odom_alpha2)"/>
        <arg name="odom_alpha3" value="$(arg odom_alpha3)"/>
        <arg name="odom_alpha4" value="$(arg odom_alpha4)"/>
        <arg name="odom_frame_id" value="$(arg odom_frame_id)"/>
        <arg name="base_frame_id" value="$(arg base_frame_id)"/>
    </include>

    <!-- move_base 포함 -->
    <include file="$(find gazebo_sim_pkg)/launch/move_base_flex_pp.launch">
        <arg name="odom_topic" value="$(arg odom_topic)" />
    </include>

    <!-- rviz -->
    <group if="$(arg open_rviz)">
        <node pkg="rviz" type="rviz" name="rviz" args="-d $(find gazebo_sim_pkg)/rviz/rviz.rviz" />
    </group>
</launch>
